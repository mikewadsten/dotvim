language: generic

sudo: false

addons:
  apt:
    packages:
      - cscope

install:
  - git clone --depth=1 https://github.com/thinca/vim-themis /tmp/themis
  - (if ! test -d $HOME/vim-7.4/bin; then git clone https://github.com/vim/vim $HOME/vim && cd $HOME/vim && git checkout . && git checkout v7.4 && ./configure --prefix=$HOME/vim-7.4 --enable-cscope && make && make install; fi)
  - (if ! test -d $HOME/vim-8.0/bin; then git --git-dir=$HOME/vim/.git worktree add --checkout $HOME/vim-8.0-src v8.0.1850 && cd $HOME/vim-8.0-src && ./configure --prefix=$HOME/vim-8.0 --enable-cscope && make && make install; fi)
  - (if ! test -d $HOME/global/bin; then wget -q https://tamacom.com/global/global-6.5.5.tar.gz -O $HOME/global-6.5.5.tar.gz && mkdir $HOME/global-6.5.5-src && cd $HOME && tar xvzf global-6.5.5.tar.gz -C $HOME/global-6.5.5-src; fi)
  - (if ! test -d $HOME/global/bin; then cd $HOME/global-6.5.5-src/global-6.5.5 && ./configure --prefix=$HOME/global && make && make install; fi)

cache:
  directories:
    - $HOME/vim-7.4
    - $HOME/vim-8.0
    - $HOME/global

script:
  - (echo ':PlugInstall | :qa' | vim -u init.vim -e; errcode=$?; if [ $errcode = 1 ]; then echo "Returned 1, which is okay?"; else echo "Returned $errcode"; exit 255; fi)
  - vim --version
  - PATH=$HOME/global/bin/:$PATH /tmp/themis/bin/themis --reporter spec
  - $HOME/vim-7.4/bin/vim --version
  - PATH=$HOME/global/bin:$HOME/vim-7.4/bin/:$PATH /tmp/themis/bin/themis --reporter spec
  - $HOME/vim-8.0/bin/vim --version
  - PATH=$HOME/global/bin:$HOME/vim-8.0/bin/:$PATH /tmp/themis/bin/themis --reporter spec
